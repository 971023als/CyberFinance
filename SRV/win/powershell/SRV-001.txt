# 관리자 권한으로 실행 요청
If (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator"))
{
    $arguments = "& '" + $myinvocation.mycommand.definition + "'"
    Start-Process powershell -Verb runAs -ArgumentList $arguments
    Break
}

# 콘솔 환경 설정
$OutputEncoding = [System.Text.Encoding]::UTF8
Write-Host "------------------------------------------Setting---------------------------------------" -ForegroundColor Green

# 디렉터리 설정
$computerName = $env:COMPUTERNAME
$rawPath = "C:\Window_${computerName}_raw"
$resultPath = "C:\Window_${computerName}_result"

Remove-Item $rawPath -Recurse -ErrorAction SilentlyContinue
Remove-Item $resultPath -Recurse -ErrorAction SilentlyContinue
New-Item -ItemType Directory -Path $rawPath, $resultPath -Force

# 시스템 정보 및 보안 정책 내보내기
secedit /EXPORT /CFG "$rawPath\Local_Security_Policy.txt"
New-Item -ItemType File -Path "$rawPath\compare.txt" -Force
[System.IO.File]::WriteAllText("$rawPath\install_path.txt", (Get-Location).Path)

# 시스템 정보
systeminfo | Out-File -FilePath "$rawPath\systeminfo.txt"

# IIS 설정
$applicationHostConfig = Get-Content $env:windir\System32\inetsrv\Config\applicationHost.Config
$applicationHostConfig | Out-File -FilePath "$rawPath\iis_setting.txt"
$applicationHostConfig | Select-String "physicalPath|bindingInformation" | Out-File -FilePath "$rawPath\iis_path.txt"

# MetaBase.xml 정보 (IIS 6 호환성 모드에서 사용할 경우)
$metaBasePath = "$env:WINDIR\system32\inetsrv\MetaBase.xml"
If (Test-Path $metaBasePath) {
    Get-Content $metaBasePath | Out-File -FilePath "$rawPath\iis_setting.txt" -Append
}

Write-Host "------------------------------------------End-------------------------------------------" -ForegroundColor Green

# SNMP 및 SMTP 서비스 설정 점검 (SRV-001, SRV-004)
# SNMP 및 SMTP 설정 점검에 필요한 로직을 추가하세요.
